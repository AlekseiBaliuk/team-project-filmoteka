{"mappings":"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","sources":["src/js/moviesGallery.js","src/js/pagination-options.js","src/js/firebase.js","src/js/trendingMovies.js"],"sourcesContent":["import { fetchMoviesByName, fetchMovieById } from './fetchAPI';\nimport { createMovieCards } from './moviesMarkup';\nimport { paginationOptions } from './pagination-options';\nimport { modalBasicLightbox } from './modalBasicLightbox';\nimport { localStorageAPI } from './localStorageAPI';\nimport Pagination from 'tui-pagination';\nimport 'tui-pagination/dist/tui-pagination.css';\nimport { async } from '@firebase/util';\n\nconst moviesContainer = document.querySelector('.movies');\nconst form = document.querySelector('.hero-home__form');\nconst failSearch = document.querySelector('.fail-search');\n\nconst localStorageApi = new localStorageAPI();\n\nmoviesContainer.addEventListener('click', onMovieCardClick);\n\nexport async function onMovieCardClick(e) {\n  const targetFilm = e.target.closest('li').dataset.id; // id текущего фильма при открытии модалки\n  if (e.target.nodeName === 'UL') {\n    return;\n  }\n\n  // try {\n  // console.log(localStorageApi.getData('current-film'));\n\n  const movies = localStorageApi.getData('movies'); // забираем фильмы из Local Storage по тегу \"movies\"\n\n  const parsedGenres = localStorageApi.getData('genresList'); // забираем жанры из Local Storage\n  const film = movies.filter(({ id }) => id === Number(targetFilm))[0]; // метод filter возвращает массив, поэтому берем элемент этого массива\n  const { genre_ids } = film;\n  let genres;\n  if (genre_ids) {\n    genres = parsedGenres\n      .filter(({ id }) => genre_ids.includes(id)) // перебираем массив всех жанров по id и возвращаем только с текущими\n      .map(({ name }) => name); //перебираем массив текущих id и возвращаем массив с именами\n  }\n  film.genres = genres; // в ключ текущего объекта film сохраняем жанры по именам\n\n  localStorageApi.setData('current-film', film);\n\n  modalBasicLightbox(film, 'movies');\n  localStorageApi.addListenersToBtns();\n  // console.log(localStorageApi.getData('current-film'));\n  // } catch (error) {\n  // console.log(error.message);\n  // }\n}\n\nform.addEventListener('submit', onFormInputHandler);\n\nasync function onFormInputHandler(event) {\n  event.preventDefault();\n  const movieName = form.elements.searchQuery.value.trim();\n  if (movieName === '') {\n    return console.log('Empty search query');\n  }\n\n  galleryFetchAndRender(movieName);\n  form.reset();\n  return;\n}\n\nasync function galleryFetchAndRender(movieName) {\n  const res = await fetchMoviesByName(movieName);\n  galleryRender(res, movieName);\n}\n\nasync function galleryFetchAndRenderByID(movieID) {\n  const res = await fetchMovieById(movieID);\n  // console.log('---galleryFetchAndRenderByID---: ', res);\n  const objResult = {};\n  objResult.results = [{ ...res }];\n  objResult.total_results = 1;\n  localStorage.setItem('movies', JSON.stringify(objResult.results));\n  galleryRender(objResult);\n}\n\nfunction galleryRender(itemRender, movieName) {\n  if (itemRender.results.length === 0) {\n    failSearch.classList.remove('is-hidden');\n    setTimeout(() => failSearch.classList.add('is-hidden'), 5000);\n    form.reset();\n    return;\n  }\n  moviesContainer.innerHTML = createMovieCards(itemRender.results);\n  const pagination = new Pagination('pagination', paginationOptions(itemRender.total_results));\n\n  pagination.on('afterMove', ({ page }) => {\n    fetchMoviesByName(movieName, page)\n      .then(itemRender => {\n        moviesContainer.innerHTML = createMovieCards(itemRender.results);\n        window.scrollTo({ top: 0, behavior: 'smooth' });\n      })\n      .catch(error => {\n        console.log(error);\n      });\n  });\n  // form.reset();\n}\n\nexport { galleryFetchAndRender, galleryFetchAndRenderByID };\n","// let visiblePages = 5;\n// const mediaQueryMobile = window.matchMedia('(max-width: 768px)');\n// const mediaQueryTablet = window.matchMedia('(min-width: 769px) and (max-width: 1279px)');\n// const mediaQueryDesktop = window.matchMedia('(min-width: 1280px)');\n\n// if (mediaQueryMobile.matches) {\n//   visiblePages = 3;\n// }\n\n// if (mediaQueryTablet.matches) {\n//   visiblePages = 5;\n// }\n\n// if (mediaQueryDesktop.matches) {\n//   visiblePages = 6;\n// }\n\n/**\n * Function returns pagination options\n * @param {number} totalResults\n * @returns {options}\n */\nfunction paginationOptions(totalResults, totalPages = 0) {\n  return {\n    totalItems: totalResults,\n    itemsPerPage: 20,\n    visiblePages: 3,\n    centerAlign: true,\n    firstItemClassName: 'pagination-first-child',\n    lastItemClassName: 'pagination-last-child',\n    usageStatistics: true,\n  };\n}\n\nexport { paginationOptions };\n","import { initializeApp } from 'firebase/app';\nimport { getDatabase, set, ref, update, get, onValue, child, remove } from 'firebase/database';\nimport {\n  getAuth,\n  createUserWithEmailAndPassword,\n  signInWithEmailAndPassword,\n  onAuthStateChanged,\n  signOut,\n  getAdditionalUserInfo,\n} from 'firebase/auth';\nimport {\n  registrationForm,\n  registrationFormName,\n  registrationFormEmail,\n  registrationFormPassword,\n  registrationFormSubmit,\n  loginForm,\n  loginFormName,\n  loginFormEmail,\n  loginFormPassword,\n  onCloseModal,\n  closeOnSubmit,\n} from '/src/js/modals/modal-auth.js';\nconst firebaseConfig = {\n  apiKey: 'AIzaSyCI5JTbKtHIHNuS4WcbgMfz2S8WxJp_ehM',\n  authDomain: 'filmoteka-proj-7.firebaseapp.com',\n  databaseURL: 'https://filmoteka-proj-7-default-rtdb.europe-west1.firebasedatabase.app/',\n  projectId: 'filmoteka-proj-7',\n  storageBucket: 'filmoteka-proj-7.appspot.com',\n  messagingSenderId: '181528100082',\n  appId: '1:181528100082:web:031dd9add36023a4e5e46b',\n  measurementId: 'G-1X27T2N03L',\n};\n\nconst app = initializeApp(firebaseConfig);\nconst database = getDatabase(app);\nconst auth = getAuth();\n\nconst logoutBtnEl = document.querySelector('.logout');\nlet userId;\nlet userEmail;\nlet email;\nlet password;\n\n// обсервер текущего пользователя\nconst welcome = document.querySelector('.welcome');\nconst login = document.querySelector('.login');\n\nonAuthStateChanged(auth, user => {\n  if (user) {\n    userId = user.uid;\n    userEmail = user.email;\n    logoutBtnEl.classList.remove('visually-hidden');\n    login.classList.add('visually-hidden');\n    console.log('current user = ', userEmail);\n    welcome.innerHTML = `Welcome, ${userEmail}!`;\n  }\n});\n\n//регистрация новых пользователей\nregistrationFormSubmit.addEventListener('click', onRegistrationSubmit);\n\nfunction onRegistrationSubmit(event) {\n  event.preventDefault();\n  // const name = registrationFormName.value;\n  const email = registrationFormEmail.value;\n  console.log(email);\n  const password = registrationFormPassword.value;\n  console.log(password);\n  createUserWithEmailAndPassword(auth, email, password)\n    .then(userCredential => {\n      // Signed in\n      const user = userCredential.user;\n      // set(ref(database, 'users/' + user.uid), {\n      //   email: email,\n      //   displayName: email,\n      // });\n      // ...\n    })\n    .catch(error => {\n      const errorCode = error.code;\n      const errorMessage = error.message;\n      console.log(errorCode);\n      console.log(errorMessage);\n      // ..\n    });\n  registrationForm.reset();\n  closeOnSubmit();\n}\n\n//авторизация существующих хользователей\nloginForm.addEventListener('submit', onLoginSubmit);\n\nfunction onLoginSubmit(event) {\n  event.preventDefault();\n  localStorage.removeItem('watched');\n  localStorage.removeItem('queue');\n  const email = loginFormEmail.value;\n  const password = loginFormPassword.value;\n\n  signInWithEmailAndPassword(auth, email, password)\n    .then(userCredential => {\n      // Signed in\n      const user = userCredential.user;\n      window.location.reload();\n      // ...\n    })\n    .catch(error => {\n      const errorCode = error.code;\n      const errorMessage = error.message;\n    });\n\n  loginForm.reset();\n  closeOnSubmit();\n}\n\n//логаут\n\nlogoutBtnEl.addEventListener('click', logOut);\n\nfunction logOut() {\n  signOut(auth)\n    .then(() => {\n      // Sign-out successful.\n      userEmail = null;\n      logoutBtnEl.classList.add('visually-hidden');\n      login.classList.remove('visually-hidden');\n      localStorage.clear();\n    })\n    .catch(error => {\n      // An error happened.\n    });\n  window.location.reload();\n  // window.location.replace('https://nilkad.github.io/js-project-7/index.html');\n}\n","import { fetchTrendingMovies } from './fetchAPI';\nimport { createMovieCards } from './moviesMarkup';\nimport { paginationOptions } from './pagination-options';\n// import './pagination-options';\nimport Pagination from 'tui-pagination';\nimport 'tui-pagination/dist/tui-pagination.css';\n\n// const paginationOptions = {\n//   totalItems: 0,\n//   itemsPerPage: 20,\n//   visiblePages: 3,\n//   centerAlign: true,\n//   firstItemClassName: 'pagination-first-child',\n//   lastItemClassName: 'pagination-last-child',\n//   usageStatistics: false,\n// };\n\nconst moviesContainer = document.querySelector('.movies');\n\n// const getPaginationsOption = totalResults => paginationOptions;\n/**\n * Function fetch trending movies and make markup on page\n */\nasync function trendingMovies() {\n  // try {\n  const res = await fetchTrendingMovies();\n  moviesContainer.innerHTML = createMovieCards(res.results);\n\n  // console.log('res: ', res);\n  // let returnPaginationOption = null;\n  // console.log(typeof paginationOptions(res.total_results)); //.then(e => (returnPaginationOption = e));\n  // paginationOptions.totalItems = res.total_results;\n  // console.log(returnPaginationOption);\n\n  const pagination = new Pagination('pagination', paginationOptions(res.total_results));\n\n  pagination.on('afterMove', ({ page }) => {\n    fetchTrendingMovies(page).then(res => {\n      moviesContainer.innerHTML = createMovieCards(res.results);\n      window.scrollTo({ top: 0, behavior: 'smooth' });\n    });\n  });\n\n  // console.log('!!!!');\n  // document.querySelector('.pagination-first-child').textContent = 1;\n  // document.querySelector('.pagination-last-child').textContent = res.;\n\n  // } catch (error) {\n  //   console.log('error', error.message);\n  // }\n}\ntrendingMovies();\n"],"names":["$bpxeT","parcelRequire","$2eef9afb10835afc$export$4a570c2dab1e2362","totalResults","totalItems","itemsPerPage","visiblePages","centerAlign","firstItemClassName","lastItemClassName","usageStatistics","$3ef5aec5c70f4381$var$moviesContainer","document","querySelector","$3ef5aec5c70f4381$var$form","$3ef5aec5c70f4381$var$failSearch","$3ef5aec5c70f4381$var$localStorageApi","$6fJbC","localStorageAPI","$3ef5aec5c70f4381$var$_onMovieCardClick","$parcel$interopDefault","$2TvXO","mark","_callee","e","targetFilm","movies","parsedGenres","film","genre_ids","genres","target","closest","dataset","id","nodeName","getData","filter","param","Number","includes","map","name","setData","$g2YN6","modalBasicLightbox","addListenersToBtns","apply","this","arguments","$3ef5aec5c70f4381$var$_onFormInputHandler","event","movieName","preventDefault","elements","searchQuery","value","trim","console","log","$3ef5aec5c70f4381$export$b9ce81fee29d949f","reset","$3ef5aec5c70f4381$var$_galleryFetchAndRender","$lbRHt","fetchMoviesByName","$3ef5aec5c70f4381$var$galleryRender","_ctx","sent","itemRender1","results","length","classList","remove","setTimeout","add","innerHTML","$aTzrc","createMovieCards","$1VFfL","total_results","on","page","then","itemRender","window","scrollTo","top","behavior","catch","error","addEventListener","$db0a627a18027f51$var$userEmail","$6Urw1","$db0a627a18027f51$var$app","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","$db0a627a18027f51$var$auth","$6Nu6u","getDatabase","$3SEMc","getAuth","$db0a627a18027f51$var$logoutBtnEl","$db0a627a18027f51$var$welcome","$db0a627a18027f51$var$login","onAuthStateChanged","user","uid","email","concat","$8uW00","registrationFormSubmit","email1","registrationFormEmail","password1","registrationFormPassword","createUserWithEmailAndPassword","userCredential","errorCode","code","errorMessage","message","registrationForm","closeOnSubmit","loginForm","localStorage","removeItem","email2","loginFormEmail","password2","loginFormPassword","signInWithEmailAndPassword","location","reload","signOut","clear","$19909c4a7d8e676e$var$moviesContainer","$19909c4a7d8e676e$var$_trendingMovies","res1","fetchTrendingMovies","res","$19909c4a7d8e676e$var$trendingMovies"],"version":3,"file":"index.40a0961c.js.map"}